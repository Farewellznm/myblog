---
title: "TCGA数据下载：TCGAbiolinks"
author: "LHS"
date: "2021-05-16"
category: Bioinfo
tags: 
- Bioinfo
output: html_document
---

为了构建可重复性数据分析流程，使用可整合的现有工具进行数据下载十分重要。
现有的下载TCGA data的工具可以用TCGA自带的下载软件GDC client和GDC Data Transfer Tool进行下载；或者使用`TCGAbiolinks`[^1]，后者更有利于可复现流程的构建。

# 1.基因表达数据的下载，建议下载counts数据

```{r eval=FALSE}
#######################################
#数据下载
#从TCGA数据库中下载满足如下条件的基因表达数据
#TCGA-PAAD RNA-Seq HTSeq - Counts open 共有177case，182个样本
if (!requireNamespace("BiocManager", quietly = TRUE))
  install.packages("BiocManager")
BiocManager::install("TCGAbiolinks")
library(TCGAbiolinks)
library(SummarizedExperiment)
library(tidyverse)
library(DT)
query.exp.hg38 <- GDCquery(project = "TCGA-PAAD", 
                           data.category = "Transcriptome Profiling", 
                           data.type = "Gene Expression Quantification", 
                           workflow.type = "HTSeq - Counts")
GDCdownload(query.exp.hg38)
expdat <- GDCprepare(query = query.exp.hg38,
                     save = TRUE, 
                     save.filename = "exp.rda")
PAADMatrix <- assay(expdat,"HTSeq - Counts")
#样本质控
#Array Array Intensity correlation (AAIC);相关系数低的可作为离群样本
PAAD_CorOutliers <- TCGAanalyze_Preprocessing(expdat)
PAADMatrix <- PAAD_CorOutliers
write.csv(PAADMatrix,"exp_matrix.csv")
```

![样本质控AAIC](../pic/PreprocessingOutput.png)

AAIC 代表样本与样本之间的相关性，相关性越低，说明样本越离群，将不纳入下游分析。因此，可以从热图和box plot中看出，相关性都大于0.8说明质量合格。

# 2.临床数据的下载

```{r eval=FALSE}
# BCR Biotab 是根据XML文件提取的
query <- GDCquery(project = "TCGA-PAAD", 
                  data.category = "Clinical",
                  data.type = "Clinical Supplement", 
                  data.format = "BCR Biotab")
GDCdownload(query)
clinical.BCRtab.all <- GDCprepare(query)
names(clinical.BCRtab.all)
# 这里要用到tidyverse和DT包，对数据进行初步检索
clinical.BCRtab.all$clinical_patient_paad %>% 
  head  %>% 
  DT::datatable(options = list(scrollX = TRUE, keys = TRUE))
# 也可以检索XML文件
query <- GDCquery(project = "TCGA-PAAD", 
                  data.category = "Clinical", 
                  file.type = "xml")
GDCdownload(query)
clinical <- GDCprepare_clinic(query, clinical.info = "patient")
write.csv(clinical,"clinical.csv")
#########
#数据下载完成

```



# Ref：

[^1]: Colaprico, Antonio, et al. “TCGAbiolinks: an R/Bioconductor package for integrative analysis of TCGA data.” Nucleic acids research 44.8 (2015): e71-e71.